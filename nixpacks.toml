[phases.install]
# 긴급 workaround: npm ci 대신 npm install 사용 (lockfile sync 문제 해결)
# preact@10.11.3 등 optional dependencies 누락 문제 우회
cmds = ["npm install --include=optional"]

[phases.build]
cmds = [
  "npx prisma generate",
  "npm run build"
]

# [phases.deploy] 섹션 제거
# migrate deploy는 빌드 단계에서 실행되면 안 됨 (P1001 오류 발생)
# migrate는 런타임 start 명령에서만 실행됨 (Railway Start Command 설정)

[start]
# Railway/Nixpacks start command 강제 지정
# 
# 현재 설정 (개발/초기 배포용):
# - db push: 스키마 동기화 (테이블 생성, 데이터 손실 허용)
# - db seed: 기본 데이터 생성 (게시판 카테고리: notice, free)
# 
# 프로덕션 안전 설정 (마이그레이션 사용):
# cmd = "npx prisma migrate deploy && npm start"
# 
# 주의: migrate deploy는 기존 마이그레이션 파일이 있어야 함
#       초기 배포 후에는 migrate deploy로 전환 권장
#
# Railway가 자동으로 포트를 할당함
# 빌드 단계에서는 절대 migrate 실행하지 않음 (P1001 오류 방지)
cmd = "npx prisma db push --accept-data-loss && npx prisma db seed && npm start"
