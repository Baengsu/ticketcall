[phases.install]
cmds = ["npm ci --include=optional"]

[phases.build]
cmds = [
  "npx prisma generate",
  "npm run build"
]

# [phases.deploy] 섹션 제거
# migrate deploy는 빌드 단계에서 실행되면 안 됨 (P1001 오류 발생)
# migrate는 런타임 start 명령에서만 실행됨 (Railway Start Command 설정)

[start]
# Railway/Nixpacks start command 강제 지정
# 1. Prisma migrate deploy로 마이그레이션 적용 (테이블 생성/업데이트)
# 2. Next.js 프로덕션 서버 시작
# Railway가 자동으로 포트를 할당함
# 빌드 단계에서는 절대 migrate 실행하지 않음 (P1001 오류 방지)
cmd = "npx prisma migrate deploy && npm start"
